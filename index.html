<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>九(9)班 · 2026 红火跨年</title>
    <style>
        :root {
            --newyear-red: #8e0000;
            --gold-glow: rgba(255, 215, 0, 0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-font-smoothing: antialiased; }

        body {
            background: radial-gradient(circle at center, #8e0000 0%, #1a0000 100%);
            color: #fff;
            font-family: -apple-system, "SF Pro Display", "PingFang SC", sans-serif;
            min-height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #bgCanvas {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
        }

        header {
            text-align: center;
            padding: 60px 20px 30px;
            opacity: 0;
            animation: fadeIn 1.2s forwards;
            z-index: 10;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        h1 {
            font-size: clamp(2rem, 8vw, 3.5rem);
            font-weight: 800;
            background: linear-gradient(180deg, #fff 30%, #ffd700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.5));
        }

        .subtitle {
            font-size: 1rem;
            color: rgba(255,255,255,0.6);
            letter-spacing: 5px;
            margin-top: 10px;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 15px;
            width: 90%;
            max-width: 1200px;
            height: calc(100vh - 220px);
            overflow-y: auto;
            padding: 20px 10px 100px;
            z-index: 10;
            scrollbar-width: none;
        }
        .grid-container::-webkit-scrollbar { display: none; }

        .name-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            height: 80px;
            display: flex;
            align-items: center; justify-content: center;
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.85);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0;
            animation: cardIn 0.6s forwards;
        }

        .name-card:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #ffd700;
            transform: scale(1.05) translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3), 0 0 10px var(--gold-glow);
            color: #fff;
        }

        @keyframes cardIn { to { opacity: 1; transform: translateY(0); } }

        #overlay {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at 50% 40%, #a30000 0%, #4a0000 45%, #0a0000 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1), visibility 0.6s;
        }

        #overlay.active { 
            visibility: visible; 
            opacity: 1; 
        }

        /* 优化容器：高度改用 vh 以适应不同屏幕，宽度 100% */
        #nameParticlesContainer {
            width: 100%;
            height: 40vh; 
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 关键：取消 Canvas 的宽高 100% 强制拉伸，由 JS 控制宽高 */
        #nameCanvas { 
            display: block;
        }

        .wish-box {
            text-align: center;
            padding: 20px;
            max-width: 600px;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s 0.8s ease;
        }

        #overlay.active .wish-box { opacity: 1; transform: translateY(0); }

        .wish {
            font-size: clamp(1.1rem, 4vw, 1.5rem);
            line-height: 1.8;
            margin-bottom: 40px;
            color: rgba(255,255,255,0.9);
            font-weight: 300;
            text-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        .btn-close {
            background: linear-gradient(135deg, #ffd700 0%, #ffa500 100%);
            color: #400;
            padding: 16px 60px;
            border-radius: 40px;
            font-weight: 700;
            font-size: 1.1rem;
            border: none;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
            transition: transform 0.3s;
        }
        .btn-close:hover { transform: scale(1.1); }

    </style>
</head>
<body>

<canvas id="bgCanvas"></canvas>

<header>
    <h1>2026 鸿运当头</h1>
    <div class="subtitle">荷塘中学 · 九(9)班 · 全员上岸</div>
</header>

<div class="grid-container" id="grid"></div>

<div id="overlay">
    <div id="nameParticlesContainer">
        <canvas id="nameCanvas"></canvas>
    </div>
    <div class="wish-box">
        <div class="wish" id="o-wish"></div>
        <button class="btn-close" onclick="closeOverlay()">收下祝福</button>
    </div>
</div>

<script>
    const PARTICLE_COLORS = ['#ffffff', '#ffd700', '#ffea00', '#ffffff'];
    const getRandColor = () => PARTICLE_COLORS[Math.floor(Math.random() * PARTICLE_COLORS.length)];

    const bgCanvas = document.getElementById('bgCanvas');
    const bgCtx = bgCanvas.getContext('2d');
    let bgParticles = [];

    function initBg() {
        bgCanvas.width = window.innerWidth;
        bgCanvas.height = window.innerHeight;
        bgParticles = [];
        for(let i=0; i<120; i++) {
            bgParticles.push({
                x: Math.random() * bgCanvas.width,
                y: Math.random() * bgCanvas.height,
                size: Math.random() * 2 + 0.5,
                vx: (Math.random() - 0.5) * 0.4,
                vy: (Math.random() - 0.5) * 0.4,
                color: getRandColor(),
                alpha: Math.random() * 0.6 + 0.2
            });
        }
    }

    function drawBg() {
        bgCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);
        bgParticles.forEach(p => {
            p.x += p.vx; p.y += p.vy;
            if(p.x < 0 || p.x > bgCanvas.width) p.vx *= -1;
            if(p.y < 0 || p.y > bgCanvas.height) p.vy *= -1;
            bgCtx.beginPath();
            bgCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            bgCtx.fillStyle = p.color;
            bgCtx.globalAlpha = p.alpha;
            bgCtx.fill();
        });
        requestAnimationFrame(drawBg);
    }
    initBg(); drawBg();

    const students = [
        {name: "安峻熙", wish: "愿你在新的一年里，才华如峻岭之巅，光芒万丈，岁岁长安。"},
        {name: "曾羚汶", wish: "愿你眼中总有星辰，心中常有繁花，在2026写下最灵动的篇章。"},
        {name: "曾贤祖", wish: "愿你志在千里，步履不停，以赤子之心奔向属于你的星辰大海。"},
        {name: "陈炳隆", wish: "愿你的未来如晨晖般绚灿，所有的梦想都能在中考之年如约而至。"},
        {name: "陈洁雯", wish: "愿你保持那份纯粹与温柔，在平凡的日子里折射出最耀眼的光芒。"},
        {name: "陈欣琪", wish: "愿你生活明朗，万物可爱，每一天都充满欣喜与琪丽。"},
        {name: "陈星雨", wish: "愿你如星辰般璀璨，如春雨般润物，在青春的赛道上尽情闪耀。"},
        {name: "高芷雅", wish: "愿你才情卓越，清雅脱俗，在最美的花季绽放出最独特的姿态。"},
        {name: "苟昊博", wish: "愿你胸怀宽广如昊天，学识渊博如瀚海，前程似锦。"},
        {name: "何有颖", wish: "愿你笑口常开，嘉言懿行，在2026年收获满满的幸福与进步。"},
        {name: "胡锦康", wish: "愿你前程似锦，身体安康，用汗水浇灌出最丰硕的梦想之果。"},
        {name: "蓝心玲", wish: "愿你心灵澄澈，聪慧伶俐，让每一刻青春都响彻快乐的铃声。"},
        {name: "黎敬恒", wish: "愿你持之以恒，心怀敬畏，在攀登学业高峰的路上永不止步。"},
        {name: "黎伟健", wish: "愿你身体强健，志向伟岸，以不凡之姿迎接未来的每一个挑战。"},
        {name: "李嘉晖", wish: "愿你的人生充满阳光，嘉誉满载，让梦想在晖光中振翅高飞。"},
        {name: "李嘉怡", wish: "愿你怡然自得，常伴欢欣，在新的旅程中遇见更好的自己。"},
        {name: "李骏霖", wish: "愿你如骏马奔驰，得甘霖滋润，在2026年马到功成。"},
        {name: "李乐恒", wish: "愿你快乐恒久，初心不改，在求知的道路上乐此不疲。"},
        {name: "李颖诗", wish: "愿你聪颖过人，生活如诗，每一个日子都值得被珍藏。"},
        {name: "李咏桐", wish: "愿你才华被世界咏唱，如梧桐般坚韧生长，直冲云霄。"},
        {name: "李宇杰", wish: "愿你胸怀宇宙，杰出不凡，在广阔的天地间书写英雄梦想。"},
        {name: "李紫泉", wish: "愿你的才思如泉涌，生活如紫气东来，高贵且充满活力。"},
        {name: "梁颖文", wish: "愿你文采斐然，聪颖灵动，在笔墨间挥洒出最美的未来。"},
        {name: "廖锐轩", wish: "愿你锐不可当，器宇轩昂，在少年时代留下最飒爽的背影。"},
        {name: "廖庄文", wish: "愿你稳重端庄，文思泉涌，以踏实的每一步跨越山海。"},
        {name: "林炯辉", wish: "愿你目光炯炯，前途辉煌，成为自己生命中最亮的星火。"},
        {name: "刘梦豪", wish: "愿你梦想远大，豪气干云，不负韶华，勇敢追逐理想。"},
        {name: "刘思涵", wish: "愿你沉思静悟，涵养深厚，在知识的海洋里扬帆远航。"},
        {name: "陆轩", wish: "愿你志存高远，气宇轩昂，在九(9)班的集体中书写卓越。"},
        {name: "聂灿威", wish: "愿你笑颜灿烂，威仪不凡，在每一个重要的时刻都闪闪发光。"},
        {name: "宁诗敏", wish: "愿你内心宁静，敏而好学，将日子过成一首优美的诗。"},
        {name: "欧荞珲", wish: "愿你如荞般坚韧，如珲般璀璨，在成长的道路上熠熠生辉。"},
        {name: "彭志恒", wish: "愿你志向远大，持之以恒，中考之时定能旗开得胜。"},
        {name: "全广浩", wish: "愿你眼界广阔，志向浩瀚，在更广阔的舞台展现全能才华。"},
        {name: "覃俊城", wish: "愿你英俊睿智，成为自己心中那座坚不可摧的梦想之城。"},
        {name: "覃旋", wish: "愿你人生旋律动听，在每一个转折点都能华丽起舞。"},
        {name: "王楚杰", wish: "愿你楚楚不凡，杰出优秀，在新的一年里更上一层楼。"},
        {name: "王梦娇", wish: "愿你梦想成真，娇艳如花，生活总是充满甜蜜与惊喜。"},
        {name: "吴咏琳", wish: "愿你歌咏青春，美如琳琅，在每一刻都散发迷人魅力。"},
        {name: "伍雨馨", wish: "愿你如春雨般润物，如馨香般远播，世界因你而温柔。"},
        {name: "邢君昊", wish: "愿你谦谦君子，气吞昊天，在追逐梦想的路上永往直前。"},
        {name: "许芷菡", wish: "愿你芳馨若芷，如菡萏初开，在最美的年纪活得清雅通透。"},
        {name: "姚洁鸿", wish: "愿你纯洁无瑕，志向鸿鹄，在广阔的天空尽情翱翔。"},
        {name: "张晗钰", wish: "愿你如晨曦般晗光，如钰石般珍贵，前路铺满阳光。"},
        {name: "张茂硕", wish: "愿你学业茂盛，果实累累，在新的篇章里收获硕果。"},
        {name: "赵曼利", wish: "愿你姿态曼妙，万事顺利，在平凡的生活里活出非凡。"},
        {name: "钟芷潼", wish: "愿你如芷兰芬芳，如清潼灵动，拥有一个最灿烂的2026。"},
        {name: "朱家年", wish: "愿你家睦人安，岁岁年年皆是好时节，万事皆如意。"},
        {name: "邹子娴", wish: "愿你聪慧娴雅，兰质蕙心，在未来的日子里被温柔以待。"}
    ];

    const grid = document.getElementById('grid');
    students.forEach((s, i) => {
        const card = document.createElement('div');
        card.className = 'name-card';
        card.innerText = s.name;
        card.style.animationDelay = `${i * 0.02}s`;
        card.onclick = () => openOverlay(s);
        grid.appendChild(card);
    });

    // --- 3. 3D 名字粒子引擎 (关键修复点) ---
    const nCanvas = document.getElementById('nameCanvas');
    const nCtx = nCanvas.getContext('2d', { willReadFrequently: true });
    let nameParticles = [];
    let animationId = null;

    class NameParticle {
        constructor(destX, destY) {
            this.x = Math.random() * nCanvas.width;
            this.y = Math.random() * nCanvas.height;
            this.z = Math.random() * 400 - 200;
            this.destX = destX;
            this.destY = destY;
            this.destZ = 0;
            this.vx = 0; this.vy = 0; this.vz = 0;
            this.ease = 0.05 + Math.random() * 0.05;
            this.friction = 0.85;
            this.size = Math.random() * 1.8 + 0.5; 
            this.color = getRandColor();
            this.alpha = Math.random() * 0.6 + 0.4;
            this.phase = Math.random() * Math.PI * 2; 
        }

        update() {
            const time = Date.now() * 0.002;
            const floatX = Math.sin(time + this.phase) * 1.5;
            const floatY = Math.cos(time * 0.8 + this.phase) * 1.5;
            
            this.vx += (this.destX + floatX - this.x) * this.ease;
            this.vy += (this.destY + floatY - this.y) * this.ease;
            this.vz += (this.destZ - this.z) * this.ease;

            this.vx *= this.friction;
            this.vy *= this.friction;
            this.vz *= this.friction;

            this.x += this.vx;
            this.y += this.vy;
            this.z += this.vz;
        }

        draw() {
            const perspective = 400 / (400 + this.z);
            // 始终相对于画布中心绘制
            const px = (this.x - nCanvas.width/2) * perspective + nCanvas.width/2;
            const py = (this.y - nCanvas.height/2) * perspective + nCanvas.height/2;
            
            nCtx.beginPath();
            nCtx.arc(px, py, this.size * perspective, 0, Math.PI * 2);
            nCtx.fillStyle = this.color;
            nCtx.globalAlpha = this.alpha * perspective;
            nCtx.fill();
        }
    }

    function initName(name) {
        // 1. 获取容器宽度，动态设置画布大小，防止拉伸
        const container = document.getElementById('nameParticlesContainer');
        const cw = container.clientWidth;
        const ch = container.clientHeight;
        
        nCanvas.width = cw;
        nCanvas.height = ch;

        // 2. 在内存中临时绘制文字以提取像素点
        nCtx.fillStyle = "#000";
        // 根据屏幕宽度自动调整字体大小
        const fontSize = Math.min(cw / (name.length + 1), ch * 0.8);
        nCtx.font = `bold ${fontSize}px 'PingFang SC', sans-serif`;
        nCtx.textAlign = "center";
        nCtx.textBaseline = "middle";
        nCtx.fillText(name, cw/2, ch/2);

        const data = nCtx.getImageData(0, 0, cw, ch).data;
        nameParticles = [];
        
        // 3. 采样步长（根据宽度微调，保证性能和清晰度）
        const step = cw < 500 ? 3 : 4; 
        
        for(let y=0; y<ch; y+=step) {
            for(let x=0; x<cw; x+=step) {
                if(data[(y*cw+x)*4+3] > 128) {
                    nameParticles.push(new NameParticle(x, y));
                }
            }
        }
    }

    function animate() {
        nCtx.clearRect(0,0,nCanvas.width, nCanvas.height);
        nameParticles.forEach(p => { p.update(); p.draw(); });
        animationId = requestAnimationFrame(animate);
    }

    function openOverlay(s) {
        document.getElementById('o-wish').innerText = s.wish;
        document.getElementById('overlay').classList.add('active');
        // 延迟一点点等待 overlay 动画开始，确保能拿到正确的容器宽度
        setTimeout(() => {
            initName(s.name);
            if(animationId) cancelAnimationFrame(animationId);
            animate();
        }, 50);
    }

    function closeOverlay() {
        document.getElementById('overlay').classList.remove('active');
        if(animationId) cancelAnimationFrame(animationId);
    }

    window.onresize = () => { 
        initBg(); 
        // 如果弹窗开着，重置名字粒子位置
        if(document.getElementById('overlay').classList.contains('active')) {
            const currentName = nameParticles.length > 0 ? students.find(s => s.wish === document.getElementById('o-wish').innerText).name : null;
            if(currentName) initName(currentName);
        }
    };
</script>
</body>
</html>
